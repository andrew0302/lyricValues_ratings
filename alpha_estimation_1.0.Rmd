---
title: "alpha_estimation_1.0"
author: "andrew demetriou"
date: "11/25/2021"
---


```{r setup, include=FALSE}
library('data.table') # data manipulation
library('here')       # file logistics
library('Hmisc')      # visualization
library('stringr')    # manipulating strings
```

```{r}
# path with the actual data
data_file_path <- here("data")

# create a list with all of the files
data_files <- list.files(data_file_path)

# read in qualtrics data file
responses_dt <- fread(here(data_file_path, "annotation_number_estimation _2.2_November 28, 2021_07.51.csv"))

# remove junk on first two rows
responses_dt <- responses_dt[3:.N][`Participant Consent`=='agree', ]

# get question wording:
questions <- colnames(fread(here(data_file_path, data_files[1]), skip=1))
```

```{r}
# logical vector indicating: 
# 1) value ratings of songs
# 2) participant ID
songs <- grepl("-1_|PROLIFIC_PID", colnames(responses_dt)) 

# keep only columns in logical vector
songs_dt <- responses_dt[, ..songs]
```

```{r}
# pivot to long format
t <- melt(songs_dt, id.var="PROLIFIC_PID")

# create vector of patterns representing each value
pattern <- paste0("-1_", seq(1, 10, 1))
#create vector of song IDs
songs <- as.character(t$variable)

#remove value pattern from each song in vector
songs <- gsub(pattern[10], "", songs)
songs <- gsub(pattern[9], "", songs)
songs <- gsub(pattern[8], "", songs) 
songs <- gsub(pattern[7], "", songs) 
songs <- gsub(pattern[6], "", songs) 
songs <- gsub(pattern[5], "", songs) 
songs <- gsub(pattern[4], "", songs) 
songs <- gsub(pattern[3], "", songs) 
songs <- gsub(pattern[2], "", songs) 
songs <- gsub(pattern[1], "", songs) 

#create new variable for song_ID
t$song_ID <- songs
```

```{r}
#t$rating <- t$value
t$variable <- as.character(t$variable)
songs <- unique(t$song)

for(i in 1:length(songs)) {
  t$variable <- gsub(songs[i], "", t$variable)
}
```

```{r}
#converts each possible response into numbers for a given column
to_value <- function(x) {
         if (x== "-1_1"){x = "y1"
  } else if (x== "-1_2"){x = "y2"
  } else if (x== "-1_3"){x = "y3"
  } else if (x== "-1_4"){x = "y4"
  } else if (x== "-1_5"){x = "y5"
  } else if (x== "-1_6"){x = "y6"
  } else if (x== "-1_7"){x = "y7"
  } else if (x== "-1_8"){x = "y8"
  } else if (x== "-1_9"){x = "y9"
  } else if (x== "-1_10"){x = "y10"
  } else {x = NA}
}
```

```{r}
#execute recode function on relevant rows
s <- t[, variable := lapply(variable, to_value)]
```



